#!/bin/execlineb
importas -i SRC 1
importas -i DEST 2
if -t {
    import -D "" SKIP_ENTRYPOINT_D
    if { s6-test -z $SKIP_ENTRYPOINT_D }
    backtick -n SCRIPTS { s6-ls $SRC }
    import -uD "" SCRIPTS
    s6-test -n $SCRIPTS
}
s6-progress "Registering entrypoint.d scripts"
if {
    forbacktickx SVC { s6-ls $DEST }
    import -u SVC
    redirfd -a 1 ${DEST}/${SVC}/dependencies
    s6-echo entrypoint.d
}
if { s6-mkdir ${DEST}/entrypoint.d }
if { redirfd -w 1 ${DEST}/entrypoint.d/type s6-echo oneshot }
if { redirfd -w 1 ${DEST}/entrypoint.d/up s6-echo "/bin/run-parts --verbose --exit-on-error ${SRC}" }
if { redirfd -a 1 ${DEST}/init/contents s6-echo "entrypoint.d" }
