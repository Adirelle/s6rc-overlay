#!/bin/execlineb
import -i S6_SCAN_DIR
cd $S6_SCAN_DIR
if {
    s6-setlock -n .shutdown.lock
    if -n {
        s6-test -e .shutdown
    }
    touch .shutdown
}
backtick -n REASON {
    import -i 0
    s6-basename $0
}
import -u REASON
s6-notice "Shutting down: ${REASON}"
if {
    multisubstitute {
        import -i S6_LIVE_DIR
        import -i S6_STOP_TIMEOUT
        import -i S6_VERBOSITY
    }
    s6-notice "Stopping services"
    s6-rc -l $S6_LIVE_DIR -v $S6_VERBOSITY -t $S6_STOP_TIMEOUT -ad change
}
s6-notice "Services stopped"
s6-notice "Stopping service supervisor"
s6-svscanctl -zst .
