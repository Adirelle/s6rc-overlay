#!/bin/execlineb
elgetopt acwueh
importas -uD "" ELGETOPT_h ELGETOPT_h
ifelse {
    s6-test -n $ELGETOPT_h
} {
    foreground {
        importas SELF 0
        s6-echo -- $SELF "[ -a | [-c] [-w] [-u] [-e] ] prog"
    }
    exit 2
}
importas -uD "" ELGETOPT_a ELGETOPT_a
multisubstitute {
    importas -i LAUNCH_ENV S6_LAUNCH_ENV
    importas -uD $ELGETOPT_a ELGETOPT_c ELGETOPT_c
    importas -uD $ELGETOPT_a ELGETOPT_w ELGETOPT_w
    importas -uD $ELGETOPT_a ELGETOPT_u ELGETOPT_u
    importas -uD $ELGETOPT_a ELGETOPT_e ELGETOPT_e
}
backtick -n __APPLYUIDGID {
    if -t {
        s6-test -n $ELGETOPT_u
    }
    s6-envdir ${LAUNCH_ENV}/user
    multisubstitute {
        importas -i UID UID
        importas -i GID GID
        importas -i GIDLIST GIDLIST
    }
    s6-echo -- /bin/s6-applyuidgid -u $UID -g $GID -G $GIDLIST
}
backtick -n __CDWORKDIR {
    if -t {
        s6-test -n $ELGETOPT_w
    }
    s6-envdir ${LAUNCH_ENV}/user
    importas -i WORKDIR WORKDIR
    s6-echo -- /bin/cd $WORKDIR
}
backtick -n __CLEARENV {
    if -t {
        s6-test -z $ELGETOPT_c
    }
    s6-echo -- -oP
}
backtick -n __ENVDIR {
    if -t {
        s6-test -n $ELGETOPT_e
    }
    s6-echo -- /bin/s6-envdir ${LAUNCH_ENV}/env
}
multisubstitute {
    importas -us __APPLYUIDGID __APPLYUIDGID
    importas -us __CDWORKDIR __CDWORKDIR
    importas -us __CLEARENV __CLEARENV
    importas -us __ENVDIR __ENVDIR
}
elgetpositionals
$__APPLYUIDGID
$__CDWORKDIR
/bin/emptyenv
$__CLEARENV
$__ENVDIR
$@
