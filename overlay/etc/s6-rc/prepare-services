#!/bin/execlineb -S0
backtick -n S6_COMPILED { s6-uniquename /run/s6rc-compiled }
backtick -n INTER { s6-uniquename /run/s6rc-source }
multisubstitute {
    define SRC /etc/services.d
    import -u INTER
    importas DEST S6_COMPILED
}
if { s6-hiercopy $SRC $INTER }
if { /etc/s6-rc/make-entrypoint-oneshot /entrypoint.d $INTER }
if { /etc/s6-rc/make-services-bundle $SRC $INTER }
wait -r { }
s6-progress "Compiling the service database"
if { s6-rc-compile -v 1 $DEST $INTER }
if { s6-rmrf $INTER }
if { ln -snf $DEST /etc/s6-rc/compiled }
$@
